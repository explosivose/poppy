doctype html
html(lang="en" data-theme="light")
  head
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    title= title
    link(href="https://cdn.jsdelivr.net/npm/daisyui@4.12.14/dist/full.min.css" rel="stylesheet")
    script(src="https://cdn.tailwindcss.com")
    link(href="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css" rel="stylesheet")
    script(src="https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js")
    script(defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js")
    style.
      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }
  body
    #map
    script.
      window.vehiclesData = !{vehicles};
      window.parkingZonesData = !{parkingZones};
    .card.w-96.bg-base-100.shadow-xl.absolute.top-4.right-4.z-10(
      x-data="journeyPlanner()"
      x-init="initMap()"
    )
      .card-body
        h2.card-title Journey Planner

        .alert.alert-info.text-sm
          span Click on the map to add journey legs. Each leg needs a start and end point.

        .overflow-y-auto.max-h-64.space-y-2(x-show="legs.length > 0 || currentLeg.start")
          template(x-for="(leg, index) in legs" :key="index")
            .card.bg-base-200.shadow-sm
              .card-body.p-3
                .font-semibold.text-sm
                  | Leg
                  span(x-text="index + 1")
                .text-xs.space-y-1
                  div
                    | Start:
                    span(x-text="leg.startCoord.lat.toFixed(4)")
                    | Â°,
                    span(x-text="leg.startCoord.lng.toFixed(4)")
                    | Â°
                  div
                    | End:
                    span(x-text="leg.endCoord.lat.toFixed(4)")
                    | Â°,
                    span(x-text="leg.endCoord.lng.toFixed(4)")
                    | Â°
                  template(x-if="leg.paths")
                    .divider.my-1
                  template(x-if="leg.paths")
                    .space-y-1
                      template(x-for="path in leg.paths")
                        .flex.items-center.gap-2.text-xs
                          span(x-text="path.mode === 'walk' ? 'ðŸš¶' : 'ðŸš—'")
                          .badge.badge-sm(x-text="path.mode")
                          span.opacity-70
                            span(x-text="Math.round(path.distance)")
                            | m

          template(x-if="currentLeg.start && !currentLeg.end")
            .alert.alert-warning.text-xs
              div
                .font-semibold Current Leg (incomplete)
                div
                  | Start:
                  span(x-text="currentLeg.start[1].toFixed(4)")
                  | Â°
                .italic.mt-1 Click on map to set end point

        .card-actions.flex-col.w-full
          button.btn.btn-primary.w-full(
            @click="planJourney()"
            :disabled="legs.length === 0 || loading"
            :class="{ 'loading': loading }"
          )
            span(x-text="loading ? 'Planning...' : 'Plan Journey'")

          button.btn.btn-ghost.w-full(@click="clearAll()") Clear All

        template(x-if="error")
          .alert.alert-error.text-sm
            span(x-text="error")

    script(src="/js/map-alpine.js")
